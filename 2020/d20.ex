t = """
Tile 1217:
.#....#..#
#.#....###
##.#....#.
##...###..
###..#..#.
.#...##...
#.#..##...
#...#.##..
#..##....#
.##.#..#..

Tile 2357:
.....#.#.#
#....#...#
.......#..
..#.....##
..........
#.#.#...##
#.#....###
...#....#.
#.##......
#..#######

Tile 1399:
.##.######
##.......#
#.##...#..
......#..#
......#...
.#........
....#.#...
....#.#...
##...#.##.
####.#####

Tile 3733:
#..#.#.#.#
#...###..#
#..#.####.
...#......
#.....#..#
...#.#....
##....#..#
##...#....
.#....#...
#.#...#..#

Tile 2503:
#..#..####
......#.##
#...#...##
..........
.#.###.#.#
.......#..
.....#...#
#.....##.#
#.........
#..#.##.#.

Tile 1511:
#.#.##.##.
#####..#.#
.#........
###..#.#..
#..#.##.##
.#....#.##
#....#....
#....##...
.........#
#..##...##

Tile 3583:
##.##..#.#
..#.####..
#......###
#.#..##.##
#.......##
#.#..#.#..
.#.###..#.
.#.....#..
#......#.#
#.##.....#

Tile 1637:
#.###..#.#
#..#.....#
.....#...#
....#....#
...#....#.
....#....#
.....#.#..
#.##.....#
#..#...#..
##..#.####

Tile 1453:
.##.#..##.
..........
###.#..#.#
#...###...
..####...#
#.#.......
#...#....#
#..#..##..
#........#
......###.

Tile 1153:
#...#..##.
#........#
..#.#...#.
.#....###.
#.#.##...#
#....#..##
##......##
..#.......
#.#......#
#..##.##..

Tile 3701:
..###.#.#.
...##....#
#..##....#
#.........
##.###...#
#..####.##
....##....
#.#.#....#
..........
.#####....

Tile 2179:
.#.#....##
..#..##.##
##..#..##.
###.#.....
..#..##...
#...#...##
......#..#
##...#..#.
..#.#.##..
#.###....#

Tile 1999:
.#...#.###
..........
#......#..
.#......#.
.#.##.....
###...#...
.......##.
#.........
..##.....#
#..##.##.#

Tile 2333:
.#.#....#.
..#.......
#..#...#..
.......#..
....#...#.
...#.##.#.
.#........
#.#....#.#
##........
#..##.#...

Tile 1733:
.####..#.#
.#..#.#..#
#..##....#
###..###.#
.###.#.###
#.#.##...#
....#....#
#....#.#..
....#..#.#
.....#....

Tile 3217:
#####.##.#
#......#.#
.........#
#.#.....##
##......#.
#..#.#...#
.##.......
#..#.....#
#.#.#..#..
...#.#...#

Tile 1471:
...#.....#
#...#...#.
##.#....#.
#.##....##
#.#.##....
..###...##
#.#...##..
.#..#...##
#.##....##
..#..#..##

Tile 2089:
###.##....
..##...###
........#.
#........#
...#.##.##
......##..
###...#...
#........#
..#.......
.....#.##.

Tile 2909:
.....####.
.#..#..###
.##..#.##.
........#.
#....#....
##.#.###..
.##..#..##
.......#..
#.........
#....#####

Tile 3433:
#.#..#....
#........#
#.#.#.#.#.
.###.##...
#....#.#.#
.#....#.##
.#....##..
.#.......#
#.....#...
.###....#.

Tile 3049:
...#......
#...##..##
##.....#.#
#.#....#.#
...#....##
......#..#
#.......##
....##...#
.#.#.##...
.######...

Tile 2143:
.######...
.##.#..###
##.##..#.#
.#....#...
.#.##...#.
#...#....#
##...#....
##..##.#..
#....##...
##.#...#.#

Tile 3299:
#..##.##..
..........
#..#.#....
.......##.
..........
..#...##..
.#....#...
#..##....#
#...#....#
.#.#.#####

Tile 2803:
..#....###
..#.##.#..
......###.
.....#....
#..##.#...
.##...#..#
#....#....
...#......
......#.##
..###..#.#

Tile 2311:
#..##....#
.....#....
.#..##..##
#..###....
#..#..#.#.
..........
..#....#.#
#..##.#.##
.###.#.#..
..##.##.#.

Tile 1123:
#.####...#
......####
..#..#...#
..#.#..###
###...#..#
.#.#.....#
.....#.##.
#.#.#..#.#
........##
...##..###

Tile 1777:
..#######.
##........
...#..#.##
........##
##......##
##....##.#
#......#..
.#...#..#.
#..#.####.
..###...#.

Tile 1321:
.###...##.
#.......#.
###....#..
.#..##.#..
#.#..##.##
###.#..###
#....#...#
#.#.#.####
.........#
.##......#

Tile 2287:
.....#..#.
.#..######
..#.#.....
#........#
#..#.#..##
.#....#.#.
#.#.#....#
....#.....
..#.....##
.#.#.#.#.#

Tile 3727:
.#.#.#..##
##.#..#.#.
##......##
##....##.#
.....#..##
#...#....#
.#....#...
....#.###.
..#......#
.####.##.#

Tile 1607:
.......#.#
#.....#...
#.....#.#.
.#..#.##.#
#.#.#.....
#.....#..#
.....##..#
.....###.#
....#.....
#..#..####

Tile 1327:
.##...#.#.
###...#...
##.......#
.......###
#.#......#
#..#.....#
.....#.#.#
#........#
#.#..#.#..
#.#..##.##

Tile 3889:
.#.#.#..#.
..##...#.#
#...#...##
#...#.#.##
#.#.......
###......#
........##
#..#....#.
.....#...#
####...#..

Tile 1447:
..###.##.#
...#.#....
.##......#
.....##...
......#...
#..#.#.#.#
#.#.#.##.#
#..#...#.#
###..##...
#.##.#...#

Tile 3767:
.#....#...
..........
##........
.#.......#
.....#.#..
.#.....#..
#......#.#
#.....#.##
.....###.#
...#.####.

Tile 2957:
##.#....##
#.#.....#.
.#....#...
#....#.#.#
......#...
#.##..#...
.........#
..#.##..##
###.......
.#...#....

Tile 3911:
..#.##.##.
#...#...#.
.#.#.#####
#.###..#.#
#..#...#..
###..#.#..
...#.#....
#.##...##.
....#.....
#...#.##.#

Tile 2683:
#.#####.#.
#..#..##..
......####
#..##..#..
#.##.#...#
#........#
###...#..#
#..#......
#.###....#
.##.#.#.#.

Tile 2267:
#.#..#.#..
...#.#..#.
#..##..#..
##.#...#.#
..#......#
##....#...
#.........
#..##.....
...#..#...
##..###.##

Tile 1709:
#..#...#..
.#.##..#.#
#...###..#
##.##.#..#
##.#......
#..#..#..#
..##...#..
#....##..#
#.....####
#######...

Tile 2347:
##.##....#
#........#
....#.#...
..#.##.###
##....##.#
...#.#.#..
#..#......
.#.......#
....#.....
.###.##.#.

Tile 1051:
###.#...##
#.#.......
#.......##
..........
###..###..
..###..#..
#..#...#..
..#.......
....##..#.
.#.#.##.##

Tile 2903:
...##.....
#..#.#....
...#......
#...#..#.#
#..#......
#...#...##
##........
#.#.......
#.....##..
...#####.#

Tile 1619:
#..###.#.#
#.#......#
#.......##
......#..#
.##......#
#.....#..#
#.##...#.#
#..##....#
.#....#.#.
.####.###.

Tile 3203:
...#.##.#.
#.###.....
.#..#..#.#
#.#..##...
.....#.#.#
..........
.##..#...#
.....##.#.
.........#
.#####.##.

Tile 2269:
.##.#...#.
#....##.#.
#.##.#.##.
#.....#..#
..........
##......##
.....##.#.
#.........
....#.....
.....##.#.

Tile 2027:
#..#######
#...##...#
...#..#.##
#...#.....
#....#....
##...#..##
#...#.#..#
###..###..
#.#..#####
#..#..#.#.

Tile 1973:
##.#.##..#
.#.#.#...#
#...#....#
#......#..
#.....##..
...#....##
.#.....#..
#.##.....#
........##
.##.#.....

Tile 3559:
.######.##
.......#..
..##....##
#.#.#.##.#
#..#.#.#.#
..#.#.#...
.#.#..#..#
#...#.#...
.#.#..#..#
##....####

Tile 3319:
#...#.....
.#..##.#..
##.#.....#
..........
..####....
.##..#....
...##.....
#..#...#..
###..#....
#.#..#####

Tile 3631:
##....#..#
.#..####.#
##.#...#.#
#....#..#.
..........
..##.....#
#..#...#.#
.......#.#
#.##..#.#.
.....####.

Tile 2377:
.....#...#
#....#....
..#.#.....
.....#..#.
........##
###.....##
#.........
....#...##
.........#
.##.#.#.#.

Tile 3331:
#..#..#.#.
##.......#
....##....
...###.#.#
.###.##.#.
###......#
#.#.##....
#.#...#...
...#.....#
..######.#

Tile 2473:
#.###....#
#...#.#.#.
#...##...#
.#..#..##.
........#.
.#.#.#...#
#.#.#..#.#
.##.......
.#.......#
##.#..###.

Tile 1039:
##..#.##.#
#......#..
###....#.#
..#..#....
.##.......
####.##..#
##..#..#..
.....#....
##....#.#.
#.....##.#

Tile 2111:
.#..#...#.
#.##.#....
.####..#.#
#..#.#.#.#
..#...#...
..#.#.#...
......#.#.
#.....#..#
..##..#..#
####....##

Tile 2039:
#.####.###
..#.#.##..
..#..#....
###.......
#.#......#
.........#
.#.......#
#.#...#.#.
####.....#
######.#..

Tile 3391:
.####.#.#.
#.#...##.#
.#.#.....#
...##...#.
.#..#..#..
..#..##...
.....#.#..
#....#....
.#..#..#..
##.##..###

Tile 1913:
.#.#######
#.#..#..##
.##.#.....
#.#......#
....##....
###..#....
........##
#.....##..
.#..##...#
##....#...

Tile 2693:
#..##.#..#
.#....#.##
.#...##..#
...##.....
###..#..##
##..#....#
...#.....#
##........
####...##.
#...#.#.##

Tile 1033:
#####.#...
#........#
#.#...#.#.
.###......
..##....#.
#...####.#
....#..#.#
.....##...
.....#..##
##..##.#..

Tile 2273:
#.##....##
..........
#..##...#.
###.......
..#.#.#.##
##.......#
##..##..#.
..........
.........#
.##..##.##

Tile 1049:
###.##....
####....#.
...#.#....
....##...#
#...#....#
##...###..
##..#.....
####......
##..##...#
.....##..#

Tile 1787:
.#.#.##.##
###.#....#
#...###.#.
..#....#..
.........#
....#.#...
.##.....#.
.....###.#
.###..#...
.##.####..

Tile 2689:
.......###
..#..#....
#......#.#
#.#.##...#
#.#.#.#...
.##.......
..#..#.#..
...##....#
#......#.#
.#.######.

Tile 1933:
######.#..
..#.#...#.
...#...#.#
###.#....#
..#.....#.
#..####...
##........
..###....#
....#.....
#####.####

Tile 1823:
###.#..#.#
..........
.#.#...#..
..#..##.#.
.#..#..##.
#.#.#....#
.#..#....#
........##
###.#.#...
#.......#.

Tile 1439:
.#.....#.#
...#.#...#
...#.#....
...##..#..
#...#..#..
...#.#...#
.#..#....#
#...###..#
#..#####..
#.#.#...##

Tile 1657:
.####.##.#
#....#....
.#..#.....
..##..#...
##..#....#
.#......#.
#.###...#.
.........#
#.####....
##....##.#

Tile 3517:
##.#.##.#.
#..#....##
##......##
#...#..#..
.##..##...
........#.
..#...##.#
#.#..#....
##....##.#
####..#...

Tile 3943:
.#.#..##.#
#........#
#..#......
#.......##
##..#.....
####...#.#
.###....#.
###.......
.##.......
..#...####

Tile 2801:
##.##.###.
##.###.#..
##.#......
..###.....
##.#..#...
#......#..
#.##.....#
##.#.#...#
....#....#
..####..#.

Tile 2411:
#.#.#.#...
.####.#.##
....#..#.#
........##
....#..#..
#...##..#.
#.#......#
#.....#...
.#....#..#
..#.....#.

Tile 3907:
#.....#..#
.##..#....
##..#.....
.....#....
.#..#.###.
#......###
......#...
##.......#
........##
####.##.#.

Tile 2819:
..#.##.#.#
..#..#...#
...#...#.#
..#...#...
#....##.#.
#.##.#....
.........#
#...#..###
###.#.....
......##..

Tile 3307:
.#.##..##.
#..#...#.#
#.#..#....
#..#....#.
....#...#.
#.#..#...#
...#.....#
..#...##..
#.#...#..#
#.#.....##

Tile 3313:
#.##...##.
.......###
....#..#..
#.###.##.#
###.#.#..#
....##....
....#.##.#
#..#.##..#
..#.###.#.
#.#.#.#.##

Tile 3037:
.###.#....
#..#..##.#
...####...
#.##..#...
#...#..#..
...#.....#
........#.
###.##.#..
#.####..#.
###..#.##.

Tile 2053:
####.#....
#.#..##..#
.#...###.#
#.####....
#.........
#.....#..#
#.#.#.....
..#.#...#.
#..#.#...#
..#..#.##.

Tile 3769:
....#..##.
#..#......
#...###..#
#..##....#
.#.......#
#.........
.#..#..##.
#.#.#..#.#
#.#.......
#..##..#..

Tile 1759:
...##....#
..........
###......#
##........
.....#....
#..##..#..
......#.#.
###..##..#
.#....#..#
......#.#.

Tile 1229:
#.##.#.#..
#..#...###
...#.....#
.#....#..#
#.##..##.#
#..#...###
..........
.....###..
..#..#..##
##.#....##

Tile 3821:
.##.####.#
......####
......#.#.
#....#.###
.#.##..#.#
..........
...#.#...#
..#...##..
##.#.#..##
####...###

Tile 1319:
#.##..#.##
...#..##..
..#.#.....
.#..#....#
#..#.#.#..
#.....#..#
#.#.#.....
...###....
##.##...#.
.#.##.##..

Tile 3167:
#.#.....##
.#...###.#
.#...##.#.
###..#...#
....##..##
.....#..##
..#...#.##
.......###
.........#
##.#.#.###

Tile 3407:
...##..#.#
.#...##...
.........#
#..#..#.#.
#.#....#.#
...#.#...#
.#.#......
....#....#
#..#....#.
.####..##.

Tile 1231:
#...#..###
#........#
##.......#
#.#..#....
#.#.#.....
.#..#.....
#...#.....
#..#...###
..#.#....#
#.##.###..

Tile 3623:
##.##.##..
#..#.....#
........#.
#........#
....#.....
.......#..
.....##..#
###...###.
..##..#..#
.#..####.#

Tile 3541:
#.......#.
##........
.####...#.
.#..#..#..
#.....#..#
..#...##..
#..#...##.
#....##..#
....#...#.
.#..#####.

Tile 2939:
..#.###..#
......##..
#...#.#...
#.........
#...#.#...
#....#....
##.....#..
.......#..
###..#####
.#.###..##

Tile 1847:
.#####.##.
....#.##.#
...#......
.#..#.....
.....#.#.#
##.##...##
.......#.#
.......###
....#..#..
...#.##...

Tile 2887:
####.##.#.
#..##...##
#..#..#...
#........#
##.#.#...#
#.#..##...
...##...#.
#.#..#...#
#.#.##....
##.##.##.#

Tile 3697:
.##.....##
#.........
###.......
..##.#....
##...#.#..
#...#....#
#........#
.#........
.#.#......
#...#...##

Tile 2081:
.###.#..#.
..#.#....#
......#.##
#..#.#..##
#...##....
#....#...#
.###......
..#..#.#.#
..#....###
#...#...##

Tile 2383:
....##.##.
.##......#
.#.......#
#.##.#...#
#..#..#..#
##.#.....#
..#.#..#..
#....#....
.#.#.#.#..
#..#.#.#..

Tile 2557:
##..#.###.
..#.......
.#....##..
...#.#....
...##.#...
#.#.#....#
........##
#.....#..#
##.....#..
.###..#.##

Tile 3637:
#..#.###.#
...#..###.
#.......#.
.......#.#
...#.#....
..........
.........#
.........#
.###..###.
###.#.#..#

Tile 3989:
...#.#.#.#
..#..###..
#...#..###
#....##...
#....#.#.#
........##
#.##....##
#.....#.##
#.##..#..#
......#...

Tile 2221:
#...##.###
.....#..#.
.#..#....#
.....#.##.
..#.##...#
........##
#.....####
.#.......#
#.##...#..
##.####...

Tile 1523:
..#..####.
.#.#......
#...#.##.#
###..#..#.
......##..
.........#
...#..##..
#....#.#.#
#......#..
.#...#...#

Tile 1583:
.####.#.##
#...#.#.##
.....#....
...#...#.#
.###.....#
..##.#...#
#.##......
#....##...
#..#.....#
.####..#..

Tile 3919:
..#..##...
.#...#....
#.####.#..
..........
#..#......
#........#
...##.#..#
...#......
#..##....#
.#....#.#.

Tile 2381:
....######
..##..##.#
#...####..
...#......
###...#.##
#...#.....
#.##....##
....#....#
......#.#.
...##.##.#

Tile 3923:
#####.#.#.
.#.....#..
....#.....
#...#....#
##........
......#..#
.....#...#
#.#...#...
.####....#
####....#.

Tile 2953:
#.#.###..#
....#.#...
.#.#....##
#...##...#
#...##..#.
###......#
.#.##.#...
.........#
##.#.##.#.
..#...#..#

Tile 2441:
....#.#.#.
##..#.#...
.....#.#.#
#....#....
#..#...###
#....#....
#......###
..#..#.###
.#.......#
.#.#.##...

Tile 3023:
#.#.#####.
..#.....##
#..#.#...#
.#....#..#
..#.#...##
##.....#..
.#....#.##
#.........
####.#....
#..##.#...

Tile 2659:
...##..#..
##...##..#
.#...#..##
##....####
....#.####
##.#......
..#.##...#
.#.#..###.
....#.##.#
.##..###.#

Tile 1069:
.##.##..##
#.........
.#....#...
##........
..#......#
.###...#.#
##...##..#
#..#.#....
..#.....#.
.#..###..#

Tile 1181:
##.##.##..
#.....#..#
..#...#..#
.##.#.....
#...#....#
#.#......#
...#...#.#
#....##..#
#..###.#..
..#..#...#

Tile 1663:
....#..#..
.###.#####
#..#...#.#
..........
.........#
.#.##....#
.##.......
.......#..
##......##
.#.##...#.

Tile 3779:
.##.##.#.#
#...#....#
#..##....#
.#...#....
##..#...#.
.........#
#...#...##
#..#......
###.....#.
..##..#.#.

Tile 1013:
#.##.#.#.#
.#..#.....
.#.#.##...
###......#
.#.##..#.#
.#..#..##.
..........
....#....#
#......#.#
#..###.###

Tile 1747:
.#.#..###.
.......##.
#..##..#..
..#.#.#...
##......##
#......##.
....##..##
..#.#...##
#...#..#..
##.###.##.

Tile 3931:
..###..#..
#..#......
##....#...
.##...#...
#........#
....#.#.#.
.###.....#
.#..#.....
##.#......
##.####..#

Tile 2593:
#.##..#..#
.##.....##
#.###...##
#..#......
##..##...#
#.##......
..#.#.#..#
..#......#
...#..#...
.####.##..

Tile 3677:
#.#.#.#.##
....#.....
.#..##....
.....##..#
..#..#.#..
..........
###..##...
##.#####.#
#...#.....
#.#..#####

Tile 2633:
.#..####.#
.###...#..
......#..#
....###...
#..#.##...
.#..##.#.#
##.....#.#
#.......##
#...#.#..#
#.#..#.#..

Tile 2129:
..##.###..
##..#...#.
..#...#...
#.....#...
......#..#
..#.##...#
....#..###
##....#...
..........
.#.#.##...

Tile 2029:
##.##.###.
#..#......
##......#.
.#.###.##.
...##...##
#..#....##
...###.#.#
....#...##
..#..#....
...#.....#

Tile 1873:
.#...#...#
#...##..##
##.#.....#
#.#..#..##
....#.....
..#..###..
......#..#
.........#
#...#...#.
##.##....#

Tile 1567:
##..##..#.
....##..#.
..#.....#.
.#.#.....#
#.#.##...#
....##...#
#....##..#
....#.#..#
.#...##..#
##.#..##.#

Tile 3571:
####....#.
.##.###.##
.........#
..#.....#.
....##.#..
.#.#.....#
#.........
#....#...#
#........#
#..#.##.#.

Tile 2671:
...#..##..
..........
#..#..##..
##....#...
#.......##
###.#..#.#
..##....##
#...#.....
.#...#...#
......##..

Tile 3229:
...#.#..#.
#.........
...##.....
...#.....#
#.##......
..#.#.#.##
...####...
.....##..#
#.........
.#.###....

Tile 3083:
##...#.#.#
#.###....#
#..#...#.#
.#...#....
#...#....#
##...#.#.#
..#......#
#.#....#.#
#..#.#.#..
.#..#.....

Tile 2239:
######.#.#
##.##.##.#
.......##.
#..#......
##.....###
........##
..#....#..
#...####..
....####..
..#.#####.

Tile 3581:
###.#..###
#.#.#....#
...#.#..##
#..#...###
.#.##.#...
#..#..#...
...#.#.#.#
#...#..##.
##....##..
##...###..

Tile 1061:
.....###..
###...#...
#.#...###.
........#.
.#.....#.#
##...##.##
.........#
#....##.#.
.#.....#..
.#...#.##.

Tile 3967:
..########
##........
.##.#...#.
..##.##.##
#.#....#.#
.#.......#
....#.....
#.##......
##..##.#..
..#...#.##

Tile 2749:
.#######.#
#..#..#...
...#......
....#....#
....#.###.
.#.#.#....
.#..#.....
...#....#.
#.##.#..#.
#####.###.

Tile 1811:
#.#.###.#.
#.........
.........#
...#......
........##
..........
.#####...#
####.#....
#.....#...
#.#.#.#..#

Tile 2477:
####.#..##
..#.##..##
#....##...
#.#...##..
####....##
#.......#.
#####....#
..#.......
......#...
.#.##.##.#

Tile 1949:
#.##..####
#.##..#.#.
###.......
##.#.....#
#..###..##
##......#.
.....#..##
##...##..#
.#........
##.##.#..#

Tile 2099:
..##.#..##
....#.#...
#....#.#.#
...#..#...
##.....##.
#..###.###
.#.....#.#
..#......#
......#...
.##..#.#..

Tile 2767:
.#.###.#..
..#.#.#...
...##.....
..#.......
......#..#
.......#.#
.....#....
#.#.##..##
..#..#....
##...#.###

Tile 3251:
..##.#....
.......#..
.....#.#.#
.#..##..##
.#.##....#
#.#....#..
##..#....#
.........#
..#..#..##
....####..

Tile 3833:
#..####.##
...#......
.#.....#.#
##..##...#
.....##..#
#..#.#....
...##...##
..#.##...#
........##
##....#.#.

Tile 3089:
..#.......
.....#....
#####...#.
##..#..#..
.#.#.##.##
..#.##..#.
.......#..
##..#....#
...#..#...
..#.###..#

Tile 2861:
#......#..
...#.....#
#.....#..#
##.......#
.#....#..#
##..#.#...
........#.
#........#
#.##...###
#.#.###...

Tile 1489:
##.##.#.##
.#.......#
#..#.##..#
#.#.......
#.#....#..
#.....##.#
.##..####.
.....#.#.#
.......###
#.#.#..#.#

Tile 1801:
#....#####
#.#......#
.........#
#.#.....##
#....#...#
.##...#...
##.###.#.#
.#.#..##.#
..#.#.#..#
##..###.#.

Tile 2677:
#.#...#.##
..........
#...#.##.#
#.#....#.#
#.....#..#
..#..#..##
#.###..#.#
##.#.....#
........##
##.####.#.

Tile 3797:
..#####.#.
#.#..#..#.
..#..#.##.
..##.#.#..
.##..#....
.##.##..#.
#......###
........#.
.#.##...#.
..#..#####
"""

defmodule D20 do
  def parse(text) do
    text
    |> String.split("\n\n")
    |> Enum.map(&(&1 |> String.trim_leading("Tile ") |> String.split(":\n")))
    |> Enum.map(fn [id, tile] -> {String.to_integer(id), tile} end)
  end

  def tile_ids_for_edge(parsed) do
    parsed
    |> Enum.map(fn {id, tile} -> {id, parse_edges(tile)} end)
    |> Enum.flat_map(fn {id, edges} -> Enum.map(edges, fn edge -> {edge, id} end) end)
    |> Enum.reduce(%{}, fn {edge, id}, acc -> Map.update(acc, edge, [id], &[id | &1]) end)
  end

  def p1(data) do
    data
    |> tile_ids_for_edge()
    |> Enum.filter(fn {_edge, ids} -> length(ids) == 1 end)
    |> Enum.frequencies_by(fn {_, [id]} -> id end)
    |> Enum.filter(fn {_k, v} -> v == 4 end)
    |> Enum.map(fn {k, _v} -> k end)
  end

  def p2(data) do
    corners = p1(data)

    tile_for_id = data |> Enum.into(%{})

    edges_for_id =
      data |> Enum.map(fn {id, tile} -> {id, parse_edges(tile)} end) |> Enum.into(%{})

    neighbours =
      data
      |> tile_ids_for_edge()
      |> Enum.reduce(%{}, fn {_, ids}, acc ->
        Enum.reduce(ids, acc, fn id, acc ->
          Enum.reduce(ids -- [id], acc, fn other_id, acc ->
            Map.update(acc, id, [other_id], &[other_id | &1])
          end)
        end)
      end)
      |> Enum.map(fn {k, v} -> {k, Enum.uniq(v)} end)
      |> Enum.into(%{})

    current = List.first(corners)
    neighbour = List.first(neighbours[current])
    border = edges_for_id[current] -- (edges_for_id[current] -- edges_for_id[neighbour])
  end

  def parse_edges(tile) do
    rows = String.split(tile, "\n", trim: true)
    row_length = byte_size(hd(rows))

    [
      List.first(rows),
      rows |> Enum.map(&binary_part(&1, row_length - 1, 1)) |> to_string(),
      rows |> List.last() |> String.reverse(),
      rows |> Enum.map(&binary_part(&1, 0, 1)) |> to_string |> String.reverse(),
      List.first(rows) |> String.reverse(),
      rows |> Enum.map(&binary_part(&1, 0, 1)) |> to_string,
      rows |> List.last(),
      rows |> Enum.map(&binary_part(&1, row_length - 1, 1)) |> to_string() |> String.reverse()
    ]
  end
end

# t
# |> D20.parse()
# |> D20.p1()
# |> Enum.reduce(1, & &1 * &2)
# |> IO.inspect()

t |> D20.parse() |> D20.p2() |> IO.inspect()

# IO.inspect D20.parse_edges("""
# #.#.#####.
# .#..######
# ..#.......
# ######....
# ####.#..#.
# .#...#.##.
# #.#####.##
# ..#.###...
# ..#.......
# ..#.###...
# """)
