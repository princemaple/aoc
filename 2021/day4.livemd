# Day4

## Untitled

<!-- livebook:{"livebook_object":"cell_input","name":"input","type":"textarea","value":"72,99,88,8,59,61,96,92,2,70,1,32,18,10,95,33,20,31,66,43,26,24,91,44,11,15,48,90,27,29,14,68,3,50,69,74,54,4,16,55,64,12,73,80,58,83,6,87,30,41,25,39,93,60,9,81,63,75,46,19,78,51,21,28,94,7,17,42,53,13,97,98,34,76,89,23,86,52,79,85,67,84,47,22,37,65,71,49,82,40,77,36,62,0,56,45,57,38,35,5\n\n91 60 70 64 83\n35 41 79 55 31\n 7 58 25  3 47\n 2 23 69 59 21\n11 22  8 87 90\n\n77 95 19 21 76\n93 92 62 35  3\n 4 29  7 41 45\n80 50 83 61 64\n39 32 91 56 48\n\n47 11 39 58 97\n63 51 40 74 71\n12 17 68 81 44\n64 85 20 84 80\n 0 77  5 18 50\n\n44 82 32  1 57\n98 88 33 83 85\n25 61 63 99 37\n 0 74  7 20 39\n71 72 22 80 28\n\n78 97  0 48 41\n56 51 62 58 90\n 8 44 98 46  1\n38 40 91 20 55\n88  2 32 86 14\n\n84 50 16 45 40\n 9 39 60 34 46\n57 20 12  3 36\n58 17 72 48 83\n73 85 49 67 66\n\n 4 30 73 83 57\n74 23 49 19 42\n72 65  8 99 13\n25  6 82 53 68\n20 86 46 48 50\n\n52 29 61 16 75\n36 19  2 82  9\n34 90 89 43 14\n69 66 20 21 11\n31 53 46 18 23\n\n37 76 34 79 99\n43  5 42 91 71\n47 54 19 82 81\n95 78 65 60 24\n32 94 92 27 66\n\n68 61 80 90 53\n33 17 52  0 23\n30 71  5 85 11\n27 39 41  6  9\n58 98  7 74 89\n\n31  5 55 67 51\n54 86 40 25 92\n91 62  9 94  7\n39  0 44 52 28\n12 17 26 46 32\n\n94 80 83 88 77\n65 71 31 86  0\n98 55 18 92 72\n 6 12 30 25 34\n67 53 14 20 47\n\n81 74 14 47  1\n83 82  4 89  8\n43 93 63 21 44\n92 61 25 77 97\n12 72 35 78 52\n\n26 39 13 37 46\n87  6 58 47 19\n24 35 45 95 52\n 5 27 42 96  0\n23 64  8 29 83\n\n53 58 18 96 93\n57 90 35 88 68\n91 89  7 80 47\n59 86 81 24 31\n43  8 66 17 94\n\n 0 97 91 67 90\n93 20 36  4 42\n43 64 28 94 34\n31  2  7 54 71\n18 35 76 86 16\n\n55 63 26 47  0\n 2 23 54 25 90\n36 13 85 31 15\n59 51 18 88 62\n44 69  9 81 58\n\n26 97 98 42 27\n 3 53 91 89 93\n87 57 12 18  5\n29 99 86 47 64\n 6 28 92 79 67\n\n 4 35 45 79 16\n33 95 99 80  9\n60 78 57 51 50\n27  5 48 21 46\n19 70 32 58 18\n\n94 82 61 66 31\n14 56 76 37 28\n42 81 50 10 40\n 2 98 47 29 62\n69 90 46 44 18\n\n87  3  8 50 17\n15 90 54 45 21\n 6 28 43 51 32\n97 84 69 30 38\n98 44 88 55 83\n\n34 19 27 43 92\n81 62 52 32 39\n50 29 83 25 82\n60 55 49 41 97\n75 94 22 69 66\n\n59 39 96 87 65\n33 18  4 71 15\n22 27 92  8 29\n19  5 32 85 45\n91 79 35  9  3\n\n41 53 51 68 85\n72 71 94 82 81\n60 38 13 16  7\n49 80 10  0 54\n20 39 59 64 99\n\n37 21 90 40 73\n85 75 16 34 99\n84 15 25 18 27\n77 32  0 76 36\n13 50 68 91 12\n\n24 26  0 14 12\n89  4 15 95 73\n54  2 55 84 42\n30 50 81 60 87\n37 94 71 91 53\n\n52  1 81 44 34\n27 60 36 19 69\n98 11 49 67 56\n77 72 40 48 66\n84  9 37 32 51\n\n58 15  7 36 55\n94 49 69 89 87\n79 70 30 77 19\n68 31 56 41 53\n47 85 74 54 46\n\n64 87 23 66  0\n29 98 72 82 80\n70 45 46 30 37\n53 54 33 86 76\n 6 75 71 68  2\n\n12 31 43 80 41\n37 15 13  2  3\n86 61  9 17 59\n55 68 72  8  1\n96 26 44 73 47\n\n67 39 95 84 10\n 5 88 13 81 99\n68 15 98  6 17\n47 85 74 32 97\n58  8 16 56 42\n\n82 31 42 84 17\n25 28  2  6 12\n78 57 16 97 18\n87 64 54 30 65\n 3 77 29 49 81\n\n24  1 43 89 46\n29 78 57 14 85\n 9 58 53 83 35\n96 42 62 68 74\n67  2 39 37 51\n\n72 26 46 52  3\n91 27 41 32 53\n25 36  7 63 22\n56 38 93 65  9\n95 19 77 64 44\n\n21 71 13 99 39\n47 17 80 85 64\n 5 18 48 27 81\n82 23 45 57 12\n83 55 26 31 32\n\n57 13 86 69 65\n42 76 35 18 39\n17 91 95 43  6\n55 97 22 54 14\n56  0  5 60 92\n\n87 12 46 42 35\n44  6 95 30 67\n51 21 68 37 59\n77 65 50 69 63\n33 56 24 57 28\n\n82 87 42 99 39\n38 55 74 28  6\n77 66  9 80 10\n47 90 32  3 98\n92 52  5 94 51\n\n16  1 87 57 66\n41 70 58 31  5\n71 88 17 42 76\n81 40 25 89 63\n92  4 61 77 64\n\n70 28 56 51 66\n44 60 25  0 45\n91 78 81 95 88\n75 43 57 67 32\n58 27 20 82 22\n\n16 98 82 79 90\n96  4 80 69 19\n 9 28 33 40 94\n 2 99 14 73 43\n76 68 74 42 30\n\n29 42 94 45  2\n25 81 46 54 26\n75 99 51 58 23\n76 72 71 64 63\n66 70 92 44 13\n\n 2 71 39 49 95\n19 84  1  7 96\n 9  6 60 93 78\n38 91 55 36 41\n64  3 10 20 74\n\n79 80 15 69 89\n36 76 83  7 72\n87 34 48  0 93\n 5 84 77 20 75\n46 27 11 55  3\n\n82 34  4 14 74\n40 39  7  6 95\n11 51 78 80 29\n97 81 38  9 71\n22 62 19 72 68\n\n54 70 90 43 98\n12 27 57 96 62\n32 76  0 86 42\n88 68 81 91 50\n10 94 18 71  2\n\n90 41 29 53 58\n59 62 14 85 66\n25 82 68 44 93\n73 32 76 67 18\n94 71 83 34 37\n\n 6 72 69 33 90\n87 60 66 85 16\n59 80 86 47 89\n32 98 17 29  5\n48 27 18 57 81\n\n10 22 98 86 82\n 8 66 71 14 93\n87 79 40 78 49\n84 63 17 54 94\n35 39 47  1 96\n\n58 60 52  6 86\n41 20 66 59  2\n92 79 88 40 71\n96  9 25 36 17\n91 32 43 38  8\n\n74  3 64 66 68\n69 37 22 76 33\n17 67 29 32 27\n63 49 46 21 60\n35 73  9 52 50\n\n 0 91  8 26  9\n 3 98 79 97  7\n37 61  1 60 47\n86 17 11 70 15\n66 53  2 90 54\n\n68 42  0 78 16\n83 88 21 87 12\n50  2 29 14 63\n72 90 81 71 91\n54 79 94 10  4\n\n28 63 97 31  4\n50 52 43 24 16\n36 77  0  9 75\n83 94 69 68 27\n93 82 42 56 34\n\n24 52 66 51 82\n50 30 34 93 67\n56 70 53 13 78\n 4 84 88 57 81\n80 74  5 95 98\n\n56 64 53 52 72\n51 48 50 60 49\n 8 46 84 95 43\n91 21  7 88 33\n94 57 80 25 54\n\n70 57 62 20 18\n86 45 41 76 32\n87 35 52  5  2\n16 77 25 39 22\n38 10  6 29 98\n\n89 54 57 80 65\n 0 38 94 15  6\n85 76 16 83 59\n92  5 53 14 95\n47 35 73 98 34\n\n64 24 90 71 69\n55 35 20 98 41\n94 70 10 73 16\n65 84 60  7 72\n83  2 22 78 99\n\n31 81 74 56 98\n13 97 95 49 67\n 9 47 42 99 60\n38 22 65 58 21\n82 45  2 28 68\n\n90 88 28 85 51\n23 93 13 55 50\n63 22  3 30 39\n 5 71 82 95 81\n57 76 12 92 56\n\n78 12 28  6 73\n59 24 43 29 31\n30 34 75 52 48\n62 57 23 74 50\n91 92  5 95 38\n\n95 88 13 22 10\n16  4 19 37 91\n50 52 60 46 77\n45 55 49 41 26\n21  7 67 48 18\n\n51 79 44 16 71\n 6 13 12 41 97\n50 25 19 63  4\n98  0 23 77 31\n27 57 52 99  3\n\n86 95  7 54 84\n50 33 48 16  9\n82 32 38  6 34\n43 80 27 37 11\n89 70 41 22 45\n\n24  3 47 68 35\n85 76  8 29  4\n 2 10  5 28 73\n92 89 50 25 56\n99 57 79 19 37\n\n 0 46 72  5 20\n62 28 24 53 44\n84 25 63 34  9\n75  1 65 59 10\n95 29 97 77 45\n\n87 90  1 17 67\n57 73 35 10 30\n65 14 46 60  6\n70 66 56 69 92\n 3 27 21 64 88\n\n20 58 53 29 66\n27  6 67 89 33\n88 60 79 69 97\n90  3 47 68 25\n48 59 42 98 39\n\n65 90 45 97 87\n75 98  7 58 42\n51  4 95 88 47\n94  6 11 53 63\n49 80  2 48 68\n\n 3 77 42 97 82\n70 58 81 18 47\n78 96 62 39 56\n22 87 71 31 94\n34 48 57 38 88\n\n70 36 65 33 45\n71  0 59 44  1\n42 37  7  5  9\n11 12 91 43 27\n60 21 57 61 99\n\n76 75 56 49  2\n36 57 39 64 77\n95 19 35 43 97\n82 34 50 44 55\n45 74 15 66 29\n\n 0 75  1 78 79\n13 37 48 27 14\n90 50 26 92 67\n89 62 87 69 33\n29 47  4  2 12\n\n74 42 24 86 61\n92 66  3 65 75\n 7  1 77 63 64\n39 91 87 28  5\n30 35 41 73 96\n\n 0 81 41 15 66\n62 19 86 31 40\n23 94 98 82 24\n61 99  1  5 60\n80 64 91 33 47\n\n16 61 56 77 57\n28 59 71 45 92\n53 20 35 66 73\n99  3 86 31 74\n94 69 84 96 90\n\n71 56 23 76 42\n90 44 58 27 15\n46 18 86 63 24\n69 49 82 38 43\n33 51 60 66 39\n\n75 78 38 25 76\n67  3 83 90 10\n40 89 47 23 88\n34 21 46 16 33\n 9 79 50  0 26\n\n81 75 80 23 41\n62  4 76  1 63\n56 39 57 28 61\n20  6 79 92 84\n88  3 90 16 12\n\n87 78  3 34 63\n98 21 24  9 99\n62 29 57 65 27\n47 52 67 76 71\n11 17 93 23 82\n\n53 68 70 38 56\n62 54 25 43 35\n 9  3 13 15 75\n59 27 26 33 83\n93 40 11 64 76\n\n27 83 26 48 77\n51 20 65 18 35\n80 30 60 44 89\n84 82 62 91 63\n12 97 11 19 34\n\n31 28 92 48 34\n 9 93 61 71 60\n52 18 97 81 62\n80 64 57 22 30\n11 88 74 29 56\n\n57 34 90 46 73\n31  0 70 66 82\n45 12 40 19 87\n91 24 59 83 14\n80 21 13 86 89\n\n 9  8 64 48 30\n 6 62 28 99 41\n79 45 83  7 55\n15 14 54 88 12\n90 74 97 96 50\n\n50 73 58 26 12\n96 98 56 34  7\n51 92 14 89 16\n41 70 80 55 13\n37 47  2 64 99\n\n98  9 70 17 18\n39 15 88 16 47\n80 41  8 51 21\n54 42 31 10 59\n37 92 33 62 68\n\n60 72 51 63 29\n83 39 41 24 14\n34  5 94 90 56\n75 80 67 17 20\n47 11 58 93 42\n\n97  7 27 42 67\n12 30 91 45 52\n62 50 87 92 71\n99 84 33  6 46\n29 55 86 47 60\n\n25 49 55 98 22\n66  9 61 59 90\n45 74 77 88  5\n 6 76  0 36 93\n23 70 33 95  2\n\n53 92 27 86 55\n66 52 26 58 38\n 2 78 69 62 65\n30  5  1 25 99\n76 43  4 13  8\n\n18 72 51 48 39\n62 19 28 44 82\n54 22 38 55 83\n86 93 42  9 32\n11 89 27 34 68\n\n85 99 35 88 76\n10 25 33 83 70\n54 81 77 73 66\n 4 74 96 41 86\n49  3 68 65 39\n\n71  0 70 14 31\n28 23 17 43 75\n13 40 38 87 97\n63 93 92 89 27\n58 76 24 53 54\n\n55 58 11 38 16\n98 86 13 12  8\n22 10 77 61 90\n37 76  2 62 45\n44 30 52 70 82\n\n89 55 12 90 63\n40 88 91 22 74\n 8  0 25  6 79\n53 23 87 77 20\n11 38 78 43 94\n\n21 14 37  8 16\n29 73 67 91 56\n 5 90 12 92 59\n64  1 42 72 94\n98 86 18 69 49\n\n79 71 82  1 77\n96 39 24 60 81\n49 16 12 63 14\n 0 32 78 37  8\n92 33 15 99 65\n\n54 11 40 55 33\n58 47  4 83 94\n46 96 16 28  5\n 0 62 95 71 39\n93 59  7 75 64\n"} -->

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
numbers =
  "input"
  |> IO.gets()
  |> String.trim()
  |> String.split(",")
  |> Enum.map(&String.to_integer/1)
  |> IO.inspect()

data =
  "input"
  |> IO.getn(1_000_000)
  |> String.split(["\r\n", "\n"], trim: true)
  |> Enum.chunk_every(5)
  |> Enum.map(fn rows ->
    Enum.map(rows, fn row ->
      row
      |> String.split()
      |> Enum.map(&String.to_integer/1)
    end)
  end)

boards =
  for board <- data do
    for {row, ri} <- Enum.with_index(board) do
      for {col, ci} <- Enum.with_index(row) do
        {col, {ri, ci}}
      end
    end
    |> List.flatten()
    |> Map.new()
    |> then(&{&1, MapSet.new(), MapSet.new()})
  end
```

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
defmodule P1 do
  def calc(boards, [n | numbers]) do
    boards =
      Enum.map(boards, fn {map, coords, ns} = original ->
        if where = Map.get(map, n) do
          {map, MapSet.put(coords, where), MapSet.put(ns, n)}
        else
          original
        end
      end)

    if winner =
         Enum.find(boards, fn {_map, coords, _} ->
           [Enum.group_by(coords, &elem(&1, 0)), Enum.group_by(coords, &elem(&1, 1))]
           |> Enum.any?(fn map ->
             Enum.any?(map, fn {_, v} -> length(v) == 5 end)
           end)
         end) do
      {map, _, ns} = winner

      map
      |> Map.keys()
      |> Kernel.--(ns |> Enum.to_list() |> IO.inspect(label: "ns"))
      |> Enum.sum()
      |> IO.inspect(label: "sum")
      |> Kernel.*(n)
    else
      calc(boards, numbers)
    end
  end
end
```

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
P1.calc(boards, numbers)
```

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
defmodule P2 do
  def calc(boards, [n | numbers]) do
    boards =
      Enum.map(boards, fn {map, coords, ns} = original ->
        if where = Map.get(map, n) do
          {map, MapSet.put(coords, where), MapSet.put(ns, n)}
        else
          original
        end
      end)

    winners =
      Enum.filter(boards, fn {_map, coords, _} ->
        [Enum.group_by(coords, &elem(&1, 0)), Enum.group_by(coords, &elem(&1, 1))]
        |> Enum.any?(fn map ->
          Enum.any?(map, fn {_, v} -> length(v) == 5 end)
        end)
      end)

    if match?(^winners, boards) do
      {map, _, ns} = List.first(boards)

      map
      |> Map.keys()
      |> Kernel.--(ns |> Enum.to_list() |> IO.inspect(label: "ns"))
      |> Enum.sum()
      |> IO.inspect(label: "sum")
      |> Kernel.*(n)
    else
      calc(boards -- winners, numbers)
    end
  end
end
```

<!-- livebook:{"reevaluate_automatically":true} -->

```elixir
P2.calc(boards, numbers)
```
